---
title: Predicting NHS patient inflows during an infectious disease outbreak or pandemic
author: SCC460 Group Project
date: February 2022
bibliography: trusts/bibliography.bib
output:
    rmarkdown::pdf_document:
    keep_tex: FALSE
    citation_package: "default"
    number_sections: FALSE
    extra_dependencies:
        - booktabs
header-includes:
    - \usepackage{color}
    - \usepackage{caption}
    - \usepackage{booktabs}
    - \captionsetup[figure]{font={normalsize, color=gray}, width=.8\linewidth}
    - \usepackage{xcolor}
    - \usepackage{tikz}
    - \usetikzlibrary{shapes.geometric, arrows.meta, matrix, arrows, automata, positioning, shadows, trees}
---

<!--- Global Settings --->
```{r include = FALSE}
knitr::opts_chunk$set(echo = FALSE)
```


<!--- Libraries --->
```{r include = FALSE}
library(ggplot2)
library(dplyr)
library(tidyr)
library(stringr)
library(magrittr)
library(latex2exp)
```
# ABSTRACT

Aim: To develop a prediction model that forecasts what the expected number of patient admissions will/might be - per day, N weeks ahead, and per NHS Trust - during an infectious disease pandemic.

\vspace{10pt}

Objectives: (a) Understanding, determining, the range of predictors that influence SARS-CoV-2 hospital admissions per NHS Trust, (b) Forecasting N weeks ahead

\vspace{35pt}

# INTRODUCTION

In progress $\ldots$ includes research strategy [@Oates2006]

\vspace{35pt}

\pagebreak

# METHODS

An exploration of ...


\vspace{10pt}

```{r out.width = '60%', fig.align = 'center', fig.cap = 'Steps'}
knitr::include_graphics(path = 'images/flow.pdf', auto_pdf = getOption(x = "knitr.graphics.auto_pdf", default = TRUE),
  dpi = NULL,  error = getOption(x = "knitr.graphics.error", default = TRUE)
)
```

\footnotesize

**Figure ...**: A high level illustration of the project's processing, analysis, modelling, and evaluation steps. The acronyms/abbreviations are
API: application programming interface, MSOA: middle layer super output area ([a United Kingdom census geography](https://www.ons.gov.uk/methodology/geography/ukgeographies/censusgeography)), LTLA: lower tier local authority ([a United Kingdom admnitrative geography](https://www.ons.gov.uk/methodology/geography/ukgeographies/administrativegeography)), ONS: office for national statistics, NHS: national health service, PHE: Public Health England.  The ONS, NHS, and PHE, are United Kingdom entities.

The data sources are &rarr; England's SARS-CoV-2 infections related measures: [coronavirus.data.gov.uk API](https://coronavirus.data.gov.uk/details/developers-guide/main-api), demographics data: [ONS](https://www.ons.gov.uk/peoplepopulationandcommunity/populationandmigration/populationestimates/datasets/middlesuperoutputareamidyearpopulationestimates),
MSOA $\leftrightarrow$ LTLA geographic codes mappings: [Open Geography Portal (geoportal)](https://geoportal.statistics.gov.uk/search?collection=Dataset&sort=name&tags=all(LUP_MSOA_WD_LAD)), annual intake of patients from one or more MSOA areas to an NHS Trust: **(a)** [NHS Trust Catchments Estimation](https://app.box.com/s/qh8gzpzeo1firv1ezfxx2e6c4tgtrudl), **(b)** [visualisations of](https://app.powerbi.com/view?r=eyJrIjoiODZmNGQ0YzItZDAwZi00MzFiLWE4NzAtMzVmNTUwMThmMTVlIiwidCI6ImVlNGUxNDk5LTRhMzUtNGIyZS1hZDQ3LTVmM2NmOWRlODY2NiIsImMiOjh9)

Please refer to the methodologies section for a description of (a) the patient flow weights, and (b) the estimation of NHS trust level measures via flow weights and LTLA level measures.

\normalsize

\pagebreak




## Data Collection

The data sources are ...

\vspace{10pt}

## SARS-CoV-2 Related Measures

EDIT (delete most)

Thus far, the focus is the [coronavirus.data.gov.uk](https://coronavirus.data.gov.uk) SARS-CoV-2 data; data extraction via
the [API](https://coronavirus.data.gov.uk/details/developers-guide/main-api).  The table below outlines the variables
in focus thus far.  A few points

* Data variables, i.e., SARS-CoV-2 data measures, are not available at equivalent granularity.  For example, only a
handful of un-aggregated measures are available at NHS Trust level; the aggregated measures depend on the un-aggregated measures.

* Age demarcations are inconsistent: At the lower tier local authority (LTLA) level, the age groups used for
*newCasesBySpecimenDateAgeDemographics*, differ from the age groups used for *vaccinationsAgeDemographics*.
Although the API does not include NHS Trust level age group decompositions, such decompositions are available
via [COVID-19 Hospital Activity](https://www.england.nhs.uk/statistics/statistical-work-areas/covid-19-hospital-activity/),
which – amazingly – uses a third different set of age group demarcations.

* A few API variables have misleading names, these [are renamed](https://github.com/premodelling/infections/blob/develop/config.py); the NHS Trust level variables have been renamed to reflect their original
[COVID-19 Hospital Activity](https://www.england.nhs.uk/statistics/statistical-work-areas/covid-19-hospital-activity/)
labels.

\vspace{10pt}

## Addressing Disparate Data

The prospective modelling measures exists at either NHS Trust or Lower Tier Local Authority (LTLA) level, and because our interest is in NHS Trust level admissions, we need the NHS Trust level forms of the LTLA measures.

\vspace{10pt}

**Approach**: In brief, a section of NHS England records the number of patients that each Middle Super Output Area (MSOA) contributes to each NHS Trust each year; each MSOA contributes patients to one or more NHS Trusts.  However, each MSOA region is a member of one LTLA region, hence the number of patients that each LTLA contributes to a NHS Trust, per year, can be calculated via appropriate aggregates.  Via these LTLA level aggregates the questions - *per LTLA that contributes to a NHS Trust*

\vspace{5pt}

* what fraction of the LTLA's patients did the trust receive?
* what fraction of the LTLA's patients, within age group 5 - 9, did the trust receive?

\vspace{5pt}

are calculable, and the resulting fractions guide the apportioning of LTLA level COVID measures
to NHS Trusts.

\vspace{10pt}

**Assumptions**: The preceding approach makes a few assumptions, e.g.,

* The 2019 patient flow fractions from a LTLA to a NHS Trust, for all admissions types, are reasonable estimates of flow
fractions for any admission type.  Not ideal.  There are several arguments against this assumption.  For example, and in relation to SARS-CoV-2, are all trusts equally equipped to deal with a respiratory pandemic?

* The population characteristics of each LTLA change minimally within a short period.  Not ideal either.

\vspace{10pt}

## Flow Weights

The total # of patients recieved by a trust
The population of a LTLA: \(\alpha\)
The population of a LTLA by age group sex: \(\alpha_{ags}\)
The population of a LTLA by age group: \(\alpha_{ag}\)
The patient population of a LTLA: \(\rho\)
The # of LTLA Patients \(\rightarrow\) NHS Trust: \(\beta\)
The fraction of a LTLA's patients received by a trust:  \(\lambda\) =  \(\beta\)/ \(\rho\)  [weight]
The estimated age group sex fraction received by a trust: \(\lambda_{ags}\) = \(\lambda\alpha_{ags} / \alpha\) [weight]
The estimated age group fraction received by a trust: \(\lambda_{ag}\) = \(\lambda\alpha_{ag} / \alpha\) [weight]

\vspace{10pt}


## Modelling

* Pre-modelling procedures.   [This point refers to the pre-ML/pre-forecasting pre-processing. It is separate from the initial pre-processing & features engineering that leads to the raw design matrix and dependent variable.]
* Data mining techniques?
* Statistical techniques?




\vspace{35pt}

# RESULTS

Project guide:

* Explain your results and what your analysis revealed

* What implications would your analysis' results have? How do your findings relate to the original question?

* Were there potential biases in your work?

* Validity

\vspace{35pt}

# CONCLUSIONS


Project Guide:

* Reflection on the approach taken. (Appropriate?)

* How would you have improved the approach in future? (Alternative methodologies, models, etc)


\vspace{35pt}

# REFERENCES

