---
title: Predicting NHS patient inflows during an infectious disease outbreak or pandemic
author: SCC460 Group Project
date: February 2022
bibliography: trusts/bibliography.bib
output:
    rmarkdown::pdf_document:
    keep_tex: FALSE
    citation_package: "default"
    number_sections: FALSE
    extra_dependencies:
        - booktabs
header-includes:
    - \usepackage{color}
    - \usepackage{caption}
    - \usepackage{booktabs}
    - \captionsetup[figure]{font={normalsize, color=gray}, width=.8\linewidth}
    - \usepackage{xcolor}
    - \usepackage{tikz}
    - \usetikzlibrary{shapes.geometric, arrows.meta, matrix, arrows, automata, positioning, shadows, trees}
---

<!--- Global Settings --->
```{r include = FALSE}
knitr::opts_chunk$set(echo = FALSE)
```


<!--- Libraries --->
```{r include = FALSE}
library(ggplot2)
library(dplyr)
library(tidyr)
library(stringr)
library(magrittr)
library(latex2exp)
```


# INTRODUCTION


\textcolor{blue}{At the end of this section $\rightarrow$ Overview of the project's methodology and findings}

\vspace{35pt}

\pagebreak

# METHODS

## Research Strategy

In progress $\ldots$ includes research strategy [@Oates2006]

\vspace{10pt}

## Data Engineering

* The data is from ... (the data sources)
* Hence, LTLA level aggregates .... (structuring, integrating)
* Hence, create features for modelling ... (features engineering)


The prospective modelling measures exists at either NHS Trust or Lower Tier Local Authority (LTLA) level, and because our interest is in NHS Trust level admissions, we need the NHS Trust level forms of the LTLA measures.

\vspace{10pt}

**Approach**: In brief, a section of NHS England records the number of patients that each Middle Super Output Area (MSOA) contributes to each NHS Trust each year; each MSOA contributes patients to one or more NHS Trusts.  However, each MSOA region is a member of one LTLA region, hence the number of patients that each LTLA contributes to a NHS Trust, per year, can be calculated via appropriate aggregates.  Via these LTLA level aggregates the questions - *per LTLA that contributes to a NHS Trust*

\vspace{5pt}

* what fraction of the LTLA's patients did the trust receive?
* what fraction of the LTLA's patients, within age group 5 - 9, did the trust receive?

\vspace{5pt}

are calculable, and the resulting fractions guide the apportioning of LTLA level COVID measures
to NHS Trusts.

\vspace{10pt}

**Assumptions**: The preceding approach makes a few assumptions, e.g.,

* The 2019 patient flow fractions from a LTLA to a NHS Trust, for all admissions types, are reasonable estimates of flow
fractions for any admission type.  Not ideal.  There are several arguments against this assumption.  For example, and in relation to SARS-CoV-2, are all trusts equally equipped to deal with a respiratory pandemic?

* The population characteristics of each LTLA change minimally within a short period.  Not ideal either.

\vspace{10pt}

**Flow weights notes**

* The total # of patients recieved by a trust
* The population of a LTLA: \(\alpha\)
* The population of a LTLA by age group sex: \(\alpha_{ags}\)
* The population of a LTLA by age group: \(\alpha_{ag}\)
* The patient population of a LTLA: \(\rho\)
* The # of LTLA Patients \(\rightarrow\) NHS Trust: \(\beta\)
* The fraction of a LTLA's patients received by a trust:  \(\lambda\) =  \(\beta\)/ \(\rho\)  [weight]
* The estimated age group sex fraction received by a trust: \(\lambda_{ags}\) = \(\lambda\alpha_{ags} / \alpha\) [weight]
* The estimated age group fraction received by a trust: \(\lambda_{ag}\) = \(\lambda\alpha_{ag} / \alpha\) [weight]


\vspace{10pt}

```{r out.width = '60%', fig.align = 'center', fig.cap = 'Steps'}
knitr::include_graphics(path = 'images/flow.pdf', auto_pdf = getOption(x = "knitr.graphics.auto_pdf", default = TRUE),
  dpi = NULL,  error = getOption(x = "knitr.graphics.error", default = TRUE)
)
```

\footnotesize

**Figure ...**: A high level illustration of the project's processing, analysis, modelling, and evaluation steps. The acronyms/abbreviations are
API: application programming interface, MSOA: middle layer super output area ([a United Kingdom census geography](https://www.ons.gov.uk/methodology/geography/ukgeographies/censusgeography)), LTLA: lower tier local authority ([a United Kingdom admnitrative geography](https://www.ons.gov.uk/methodology/geography/ukgeographies/administrativegeography)), ONS: office for national statistics, NHS: national health service, PHE: Public Health England.  The ONS, NHS, and PHE, are United Kingdom entities.

The data sources are &rarr; England's SARS-CoV-2 infections related measures: [coronavirus.data.gov.uk API](https://coronavirus.data.gov.uk/details/developers-guide/main-api), demographics data: [ONS](https://www.ons.gov.uk/peoplepopulationandcommunity/populationandmigration/populationestimates/datasets/middlesuperoutputareamidyearpopulationestimates),
MSOA $\leftrightarrow$ LTLA geographic codes mappings: [Open Geography Portal (geoportal)](https://geoportal.statistics.gov.uk/search?collection=Dataset&sort=name&tags=all(LUP_MSOA_WD_LAD)), annual intake of patients from one or more MSOA areas to an NHS Trust: **(a)** [NHS Trust Catchments Estimation](https://app.box.com/s/qh8gzpzeo1firv1ezfxx2e6c4tgtrudl), **(b)** [visualisations of](https://app.powerbi.com/view?r=eyJrIjoiODZmNGQ0YzItZDAwZi00MzFiLWE4NzAtMzVmNTUwMThmMTVlIiwidCI6ImVlNGUxNDk5LTRhMzUtNGIyZS1hZDQ3LTVmM2NmOWRlODY2NiIsImMiOjh9)

Please refer to the methodologies section for a description of (a) the patient flow weights, and (b) the estimation of NHS trust level measures via flow weights and LTLA level measures.
\normalsize

\pagebreak

\vspace{10pt}


## Modelling

* Pre-modelling procedures.   [This point refers to the pre-ML/pre-forecasting pre-processing. It is separate from the initial pre-processing & features engineering that leads to the raw design matrix and dependent variable.]
* Data mining techniques?
* Statistical techniques?

H.A., J.R., C.O. were discussing:

* Data preparation ... temporal splitting, [rec, diff,  ...]
* model design & training ...
  * CNN, LSTM, GRU ... why?  briefly discuss type of problem
  * Window ... why?  ... forecasting 15 days into the future based on unknown "effective days of history" ... windows allow us to investigate via varying history window sizes

\vspace{10pt}

## Evaluation
A brief description of the evaluation metrics.  [Results discusses the evaluations in detail]


\vspace{35pt}


# RESULTS

## Model Evaluation

Project guide:

* Explain your results and what your analysis revealed ()

* What implications would your analysis' results have? How do your findings relate to the original question?

## Biases & Validity

* Were there potential biases in your work?

* Validity (remember to discuss what would have been done differently to address identified limitations)



\vspace{35pt}



# CONCLUSIONS


Project Guide:

* Reflection on the approach taken. (Appropriate?)

* How would you have improved the approach in future? (Alternative methodologies, models, etc)


\vspace{35pt}

# REFERENCES

